# ProfessionCustom 模组词条教学（Forge 1.20.1）

本教程文档主要介绍本模组中的三类“词条 / 标签”系统：

- **生物标签（Mob Tags）**：会自动随机附着在刷新的生物身上，改变其战斗行为与强度。
- **武器词条（Weapon Attributes）**：附着在武器上的前缀属性，改变伤害与特殊效果。
- **装备词条（Armor Attributes）**：附着在防具上的前缀属性，改变承伤方式与生存能力。

> 数据包配置格式、数值自定义等内容请参考项目内的 `CONFIG_DATAPACK.md`。

---

## 一、生物标签系统（Mob Tags）

### 1. 基本规则

- **适用对象**：非玩家的所有 `LivingEntity`，且未被职业配置排除的生物。
- **分配时机**：生物生成或加入世界时，由 `MobTagManager` 自动随机分配。
- **标签数量**：每只生物**最多 2 个标签**，至少 1 个。
- **标签等级**：每个标签有 **1~5 级**，等级越高效果越强。
- **等级来源**：标签等级由生物等级决定，高等级生物更容易获得高等级标签。
- **出现概率**：
  - 默认每种标签概率约为 25%。
  - 可通过数据包 `tag_probabilities` 字段为各标签单独设定概率。

生物身上会附加类似 `professioncustom:tag_cold`、`professioncustom:tag_cold_level_3` 这样的原版实体 Tag，用于持久化和显示。

### 2. 生物标签总览

| 标签中文名 | 内部 ID（实体 Tag） | 概要效果 |
| ---------- | ------------------- | -------- |
| **寒冷**   | `professioncustom:tag_cold`       | 攻击时有概率冰缓目标，自身周围带减速光环 |
| **复活**   | `professioncustom:tag_resurrect`  | 死亡时有概率复活，恢复部分生命并附加增益 |
| **暴虐**   | `professioncustom:tag_brutal`     | 提高攻击伤害，并有额外暴击粒子效果 |
| **自爆**   | `professioncustom:tag_explosive`  | 死亡时发生爆炸，威力随等级提高 |
| **贪婪**   | `professioncustom:tag_greedy`     | 攻击造成双倍伤害，但会消耗自身生命 |
| **吸血**   | `professioncustom:tag_vampire`    | 按造成伤害的一定比例回复生命值 |
| **光爆**   | `professioncustom:tag_lightburst` | 攻击时对目标施加失明和黑暗效果 |
| **狂刃**   | `professioncustom:tag_frenzy`     | 攻击时对周围单位造成溅射伤害（范围伤害） |
| **急速**   | `professioncustom:tag_swift`      | 大幅提升移动速度，并带有长时间速度效果 |
| **无双**   | `professioncustom:tag_unmatched`  | 大幅提升最大生命、攻击力与护甲等属性 |
| **灵魂**   | `professioncustom:tag_soul`       | 免疫普通物理攻击，仅能被特定伤害击中 |
| **瞬移**   | `professioncustom:tag_teleport`   | 生命值每掉一定比例会瞬移到攻击者附近 |
| **天神**   | `professioncustom:tag_celestial`  | 被攻击时控制攻击者并在其头顶降下打击 |
| **领队**   | `professioncustom:tag_leader`     | 被攻击时召唤同类小弟协助战斗 |
| **绝境**   | `professioncustom:tag_desperate`  | 低血量时爆发，抛弃自身标签并一次性获得多种强大标签 |

下面对每个标签的具体效果做详细说明（数值仅为逻辑说明，实际数值会随等级和配置改变）。

### 3. 各标签详细说明

#### 3.1 寒冷（COLD）

- **ID**：`professioncustom:tag_cold`
- **核心效果**：冰缓与减速光环。
- **具体机制**：
  - 攻击时：
    - 按等级有 40% ~ 80% 概率给目标施加 **移动缓慢** 效果，持续时间与放大等级随标签等级提升。
    - 同时在目标周围生成雪花粒子。
  - 光环效果：
    - 拥有“寒冷”的生物会定期检测附近玩家，按等级 15%~35% 概率给范围内玩家施加短暂的移动缓慢效果。
    - 等级越高，影响范围越大（约 3~5 格）。

#### 3.2 复活（RESURRECT）

- **ID**：`professioncustom:tag_resurrect`
- **核心效果**：死亡判定时有概率直接复活。
- **具体机制**：
  - 生物死亡时进行一次判定：
    - 等级 1~5 对应约 20% ~ 60% 的复活概率。
  - 触发后：
    - 取消本次死亡事件。
    - 回复最大生命值的 40% ~ 60%。
    - 给予 **再生** 与 **抗性提升** 效果一段时间，等级越高持续时间越久、抗性等级越高。
    - 播放图腾粒子特效。

#### 3.3 暴虐（BRUTAL）

- **ID**：`professioncustom:tag_brutal`
- **核心效果**：提高攻击伤害，展示暴击粒子。
- **具体机制**：
  - 攻击时在目标附近生成大量 **暴击粒子**。
  - 实际伤害结算时：
    - 在受伤事件中，将当前伤害提高 20% ~ 60%（随标签等级线性上升）。

#### 3.4 自爆（EXPLOSIVE）

- **ID**：`professioncustom:tag_explosive`
- **核心效果**：死亡时在原地发生爆炸。
- **具体机制**：
  - 死亡后由服务端延迟执行一次爆炸，避免与死亡过程冲突。
  - 爆炸威力 = 基础值 + 等级加成 + 随机浮动，具体数值可在 `mob_tag_configs` 数据包中配置。
  - 随等级提高产生更多爆炸粒子。
  - 有一定概率在爆炸中附带“着火”，概率也可配置并随等级提升。

#### 3.5 贪婪（GREEDY）

- **ID**：`professioncustom:tag_greedy`
- **核心效果**：用生命换取更高伤害的高风险标签。
- **具体机制**：
  - 每次攻击时：
    - 造成的伤害直接翻倍（x2）。
    - 同时按最大生命的一定百分比（约 5% ~ 15%，随等级提升）对自己造成一次魔法伤害。
  - 适合高血量且有回复能力的怪物。

#### 3.6 吸血（VAMPIRE）

- **ID**：`professioncustom:tag_vampire`
- **核心效果**：根据造成的伤害回复生命。
- **具体机制**：
  - 每次造成伤害后：
    - 按造成伤害的 10% ~ 50% 回复自身生命，比例随标签等级提升。
    - 同时在攻击者身上播放心形粒子。

#### 3.7 光爆（LIGHTBURST）

- **ID**：`professioncustom:tag_lightburst`
- **核心效果**：攻击时致盲并让视野变暗。
- **具体机制**：
  - 每次成功命中目标时：
    - 对目标施加 **失明** 与 **黑暗** 效果，持续时间与标签等级相关（约 3~7 秒）。
    - 在目标周围生成闪光粒子。

#### 3.8 狂刃（FRENZY）

- **ID**：`professioncustom:tag_frenzy`
- **核心效果**：攻击时对周边目标造成范围溅射伤害。
- **具体机制**：
  - 每次攻击时，以目标为中心在一定范围（约 2~4 格，随等级提升）内搜索其他生物：
    - 对不包括攻击者和原目标的其他生物造成同等伤害。
    - 播放横扫攻击粒子。

#### 3.9 急速（SWIFT）

- **ID**：`professioncustom:tag_swift`
- **核心效果**：显著提高移动速度。
- **具体机制**：
  - 生物加入世界时检查是否拥有此标签：
    - 为移动速度属性添加一个永久的加成，约 20% ~ 100%（随等级线性上升）。
    - 给予长时间的 **速度** 药水效果，用作视觉反馈（几乎视作永久）。

#### 3.10 无双（UNMATCHED）

- **ID**：`professioncustom:tag_unmatched`
- **核心效果**：全面强化生物的生命值、攻击力与护甲。
- **具体机制**：
  - 生物加入世界时：
    - 将最大生命值按 2x ~ 6x 的倍率提升（等级 1 对应 2 倍）。
    - 将攻击力、护甲值也按同倍率增加（通过属性修正器实现）。
    - 同时会立刻将当前生命设置为新的最大生命。
  - 在“绝境”触发后再次应用，以保证爆发后的怪物完全成长起来。

#### 3.11 灵魂（SOUL）

- **ID**：`professioncustom:tag_soul`
- **核心效果**：免疫绝大多数普通攻击，仅能被特定伤害或带有“灵魂伤害”词条的武器击中。
- **具体机制**：
  - 当拥有“灵魂”标签的生物受到伤害时：
    - 只有以下伤害类型会生效：
      - **爆炸伤害**。
      - **魔法 / 凋零** 等特殊伤害。
      - **投射物**（箭矢等）。
      - **火焰 / 岩浆** 伤害。
      - 或者来自**带有武器词条“灵魂伤害（SOUL_DAMAGE）”**的玩家武器。
    - 其它普通物理攻击将被完全抵消，并播放灵魂粒子。
  - 若玩家武器带有“灵魂伤害”数值：
    - 攻击此类生物时不仅不会被免疫，还会额外附加一段灵魂伤害。

#### 3.12 瞬移（TELEPORT）

- **ID**：`professioncustom:tag_teleport`
- **核心效果**：在生命值下降到一定比例时瞬移到攻击者附近。
- **具体机制**：
  - 为每只拥有此标签的生物记录“上次生命值百分比”。
  - 当其生命百分比相较于上一次**降低 ≥10%** 时：
    - 有攻击者时会瞬移到攻击者附近随机位置。
    - 播放大量传送门粒子。
  - 每次触发后更新记录的生命值百分比。

#### 3.13 天神（CELESTIAL）

- **ID**：`professioncustom:tag_celestial`
- **核心效果**：被攻击时控制攻击者并在其头顶降下神罚。
- **具体机制**：
  - 被攻击时按等级 20% ~ 60% 概率触发：
    - 给攻击者施加 **漂浮（悬浮）** 效果若干秒。
    - 在攻击者头顶上方生成大量粒子，表现为能量聚集。
    - 随后对攻击者造成基于天神生物最大生命 10% ~ 35% 的一次性魔法伤害。
    - 在攻击者附近触发一次小范围爆炸（不会破坏地形）。

#### 3.14 领队（LEADER）

- **ID**：`professioncustom:tag_leader`
- **核心效果**：被攻击时召唤同类小弟一起围攻玩家。
- **具体机制**：
  - 每个拥有“领队”的生物都有一个“已召唤数量”计数。
  - 当其被攻击时：
    - 若当前召唤数小于标签等级，则有机会：
      - 在其身边随机位置召唤同类型新生物。
      - 新生物的等级会略低于本体（比原生物等级低 1~3 级）。
      - 播放图腾粒子作为召唤特效。

#### 3.15 绝境（DESPERATE）

- **ID**：`professioncustom:tag_desperate`
- **核心效果**：生命值极低时进入“绝境爆发”，一次性获得多种强力标签。
- **具体机制**：
  - 当拥有“绝境”的生物生命值低于 **5% 最大生命** 时触发：
    - 从实体上移除 `tag_desperate`，并清理缓存中的旧标签数据。
    - 立刻为该生物添加以下多个标签，等级均等于原绝境等级：
      - `tag_soul`（灵魂）
      - `tag_unmatched`（无双）
      - `tag_explosive`（自爆）
      - `tag_swift`（急速）
      - `tag_celestial`（天神）
      - `tag_vampire`（吸血）
    - 同步更新实体的 Tag 和内部缓存，并重新应用 **急速**、**无双** 等属性加成。
    - 在生物周围大量生成图腾粒子，表示进入最终形态。

---

## 二、武器词条（Weapon Attributes）

武器词条由 `WeaponAttribute` 枚举定义，通常通过自定义武器数据或 NBT 写入，战斗时由事件处理逻辑读取并应用到伤害计算中。

### 1. 词条列表总览

| 中文名   | 枚举名 / 键 | 是否数值型 | 主要效果 |
| -------- | ----------- | ---------- | -------- |
| 攻击力   | `ATTACK_DAMAGE`      | 是 | 提高基础伤害数值，在所有伤害结算前先加上该值 |
| 暴击率   | `CRITICAL_RATE`      | 是 | 提高暴击触发概率（百分比），显示时带 `%` |
| 暴击伤害 | `CRITICAL_DAMAGE`    | 是 | 提高暴击时的伤害倍率，显示时以 `x` 为后缀 |
| 火焰伤害 | `FIRE_DAMAGE`        | 是 | 额外附加火焰伤害，并点燃目标 |
| 冰冻伤害 | `ICE_DAMAGE`         | 是 | 额外附加冰冻伤害，并降低目标移动速度 |
| 灵魂伤害 | `SOUL_DAMAGE`        | 是 | 额外附加灵魂伤害，可对带“灵魂”标签的怪物造成额外伤害 |
| 秒伤     | `DAMAGE_PER_SECOND`  | 是 | 在一段时间内持续对目标造成伤害（DPS 类效果，显示 `/s`） |
| 吸血率   | `LIFESTEAL_RATE`     | 是 | 有一定概率按造成伤害的百分比回复自身生命，显示 `%` |
| 吸血倍率 | `LIFESTEAL_MULTIPLIER` | 是 | 提高吸血时将伤害转为生命值的倍率，显示 `x` |
| 光爆     | `LIGHTBURST`         | 否 | 攻击时对目标施加失明与黑暗效果（开/关型词条） |

> 数值型词条在显示时会根据小数位自动格式化，整数不显示小数；暴击率、吸血率等会自动加上 `%`，倍率会自动加上 `x`。

### 2. 核心联动：灵魂伤害与灵魂标签

- 当玩家武器带有 **“灵魂伤害（SOUL_DAMAGE）”** 词条且数值大于 0 时：
  - 攻击拥有生物标签 **“灵魂（SOUL）”** 的怪物时：
    - 该普通攻击不会被“灵魂”标签免疫。
    - 还会额外附加一段灵魂伤害，数值与武器词条中的 `SOUL_DAMAGE` 值相关。
- 这使得 `SOUL_DAMAGE` 成为对付“灵魂怪”的专用词条。

---

## 三、装备词条（Armor Attributes）

装备词条由 `ArmorAttribute` 枚举定义，通常附着在防具上。与武器相比，防具词条更偏向 **减伤、防御机制改变、反伤与控制**。

### 1. 词条列表总览

| 中文名 | 枚举名 / 键 | 是否数值型 | 简要效果 |
| ------ | ----------- | ---------- | -------- |
| 重甲   | `HEAVY_ARMOR`     | 是 | 每次受到伤害前先减去该固定数值，相当于额外护甲条 |
| 限伤   | `DAMAGE_LIMIT`    | 是 | 本次承受的伤害不会超过该值（为单次伤害设置上限） |
| 反甲   | `THORNS`          | 是 | 反弹一定比例受到的伤害给攻击者，百分比随数值变化 |
| 定伤   | `FIXED_DAMAGE`    | 是 | 每次只承受固定伤害，超过约 800% 时失效，用于极端减伤玩法 |
| 延缓   | `SLOW`            | 是 | 受到攻击时使攻击者缓慢，数值越大触发概率越高（百分比） |
| 晕厥   | `STUN`            | 是 | 受到攻击时使攻击者失明、反胃，数值越大触发概率越高（百分比） |
| 恢复   | `REGEN`           | 是 | 每秒恢复一定生命值，类似生命回复光环 |
| 爆甲   | `EXPLOSIVE`       | 是 | 受到攻击时有概率在周围产生对自己无效的爆炸 |
| 灵魂   | `SOUL_IMMUNE`     | 否 | 让穿戴者免疫直接伤害（具体实现视事件逻辑而定） |
| 狂躁   | `BERSERK`         | 是 | 提高自身攻击力，但每次攻击会扣除一定百分比生命 |
| 速度   | `SPEED`           | 是 | 提高移动速度 |
| 修复   | `REPAIR`          | 是 | 每秒修复少量装备耐久 |
| 闪避   | `DODGE`           | 是 | 有一定概率完全闪避一次攻击（百分比） |
| 震荡   | `SHOCK`           | 是 | 受到攻击时震荡附近生物并造成伤害，数值越大触发概率越高（百分比） |

### 2. 数值显示与判定说明

- 大部分防具词条为**数值型**：
  - 内部使用双精度数值，在 UI 上会自动格式化为整数或一位小数。
  - `THORNS`、`DODGE`、`SLOW`、`STUN`、`EXPLOSIVE`、`BERSERK` 等以 **百分比** 表示时，会自动添加 `%` 后缀。
- “灵魂（SOUL_IMMUNE）”等布尔型词条只表示“有 / 无”，没有数值显示。

---

## 四、进阶：如何利用这些词条设计玩法

以下是一些结合实际战斗的使用建议：

- **给 Boss 配置标签**：
  - 典型组合如：`无双 + 急速 + 领队 + 绝境`，可以让 Boss 前期强度适中，残血时爆发进入最终形态并召唤小弟。
  - 若希望 Boss 对普通玩家武器免疫，可加上 `灵魂`，再通过掉落带有 `SOUL_DAMAGE` 的武器引导玩家破盾。
- **普通怪物分层**：
  - 低级怪：优先使用 `寒冷`、`狂刃` 等简单效果。
  - 高级怪：可以叠加 `贪婪`、`吸血`、`光爆` 等更复杂的战斗机制。
- **武器与防具联动**：
  - 武器走高暴击路线：堆叠 `攻击力 + 暴击率 + 暴击伤害`。
  - 生存向防具：多堆 `重甲 + 限伤 + 恢复 + 修复`。
  - 风险高收益流：`狂躁 + 贪婪` 搭配高回复或吸血。

如需扩展新的标签或自定义数值，请在数据包中新增对应配置，具体字段与目录结构以 `CONFIG_DATAPACK.md` 为准。
